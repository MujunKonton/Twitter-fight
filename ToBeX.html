<!DOCTYPE html>
	<meta charset="UTF-8">
<link rel="icon" href="favicon.png">
<link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
<head>
<audio id="audio"></audio>
	<title>Twitterrrrrrrrr</title>
	<style>
	</style>
</head>

<canvas id="canvas"></canvas>
<style>

html {
-ms-touch-action:manipulation;
touch-action:manipulation;
}
canvas {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}



</style>
<body bgcolor="#000000">



<script>

canvas.width = window.innerWidth - 20  ;	//canvasの横幅（よこはば）
canvas.height = window.innerHeight - 20  ;	//canvasの縦幅（たてはば）

var widorhei = 0
var bottom = 256 * (window.innerHeight / window.innerWidth)
var right = 256 * (window.innerWidth / window.innerHeight)

if (innerWidth <= innerHeight){
widorhei = window.innerWidth
//canvas.height = canvas.width
}
if (innerWidth > innerHeight){
widorhei = window.innerHeight
//canvas.width = canvas.height
}

var ctx = canvas.getContext( '2d' );//コンテキストを取得（しゅとく）
ctx.scale(widorhei / 256,widorhei / 256);

window.addEventListener('resize',function(){//主に画面回転やなーーーーーーーーーーーーーー

canvas.width = window.innerWidth - 20  ;	//canvasの横幅（よこはば）
canvas.height = window.innerHeight - 20  ;	//canvasの縦幅（たてはば）

widorhei = 0
bottom = 256 * (window.innerHeight / window.innerWidth)
right = 256 * (window.innerWidth / window.innerHeight)
if (innerWidth <= innerHeight){
widorhei = window.innerWidth
//canvas.height = canvas.width
}
if (innerWidth > innerHeight){
widorhei = window.innerHeight
//canvas.width = canvas.height
}

ctx.scale(widorhei / 256,widorhei / 256);
if (playing == false){

var iimg = new Image()
iimg.src = 'title.png'
if (window.innerWidth > window.innerHeight){
ctx.drawImage(iimg,right / 2 - 128,0,256,256)
}else{
ctx.drawImage(iimg,0,0,256,256)}

ctx.font = '20px Pixel'
ctx.fillStyle = '#f0f';
ctx.fillText('横画面にしてちょーだい',2,bottom - 100)
ctx.fillText('Play with landscape screen.',2,bottom - 70)
ctx.fillText('Tap to start.(or Press Key)',2,bottom - 40)
var scr = localStorage.getItem('score')
if (scr > 0){
ctx.fillText('HighScore:' + scr,2,bottom - 10)
}
}
if (gameover == true){

var iimg = new Image()
iimg.src = 'title.png'
if (window.innerWidth > window.innerHeight){
ctx.drawImage(iimg,right / 2 - 128,0,256,256)
}else{
ctx.drawImage(iimg,0,0,256,256)}
ctx.fillText('Oh,Blue Bird!',2,170)

}
});//

function addimg3(a){
img3.push(new Image())
img3[img3.length -1].src = a
}

var img1 = new Image();
img1.src = 'Haikei.png'  
var img2 = new Image();
img2.src = 'tori.png'  
var img3 = []
addimg3('tes.png')

var tama1 = new Image();
tama1.src = 'tama1.png'  
var tama2= new Image();
tama2.src = 'tama2.png'  
var tama3 = new Image();
tama3.src = 'tama3.png'  
var tama4 = new Image();
tama4.src = 'tama4.png'  

var imgs = [tama1,tama2,tama3,tama4]

ctx.imageSmoothingEnabled = false;

var px = 128//鳥座標
var py = 128//

var xx = 0//動き
var yy = 0



var ex = []
var ey = []
var exx = []
var eyy = []
var es = []



var aud = new Audio("twittertttt.mp3");
aud = new Audio("twittertttt.mp3");
aud.loop= true
//aud.play()
var playing = false
var gameover = false
var time = 0
var mous = 0
var mv = 0

var score = 0
var t = []
var s = []

function shoot(){

var nt = new Object();
var nt = new Object();
nt.p = ch;
nt.x = px;
nt.y = py;
nt.xx =  10;
s.push(nt);
}

function tt(shurui,x,y,xx,yy){//弾生成
var nt = new Object();
nt.s = shurui - 1;
nt.x = x;
nt.y = y;
nt.xx = xx;
nt.yy = yy;
t.push(nt);
}
function gmover(){

var iimg = new Image()
iimg.src = 'title.png'
if (window.innerWidth > window.innerHeight){
ctx.drawImage(iimg,right / 2 - 128,0,256,256)
}else{
ctx.drawImage(iimg,0,0,256,256)}
ctx.fillText('Oh, Blue Bird!',2,170)

gameover = true
playing = false
px = 0
py = 0
var highscore = localStorage.getItem('score');
if (highscore >= score){
alert("Gameover. Score:" + score + `.
HighScore:` + highscore)
}else if(highscore > 0){
alert("New Record! Score:" + score)
localStorage.setItem('score', score);
}else{
alert("GameOver. Score:" + score)
localStorage.setItem('score', score);

}
}

var te = -1//敵は誰
var tey = 128//敵y
var tehp = 100//敵hp
var xxx = 0
var yyy = 0//キー操作系
var hp = 100

var tp = 100//攻撃ポイント
var ch = 0//チャージ
var chg = 0//チャージ中?0==no,1==yes
function main() {//メインるーーーーーーーーーーーーーーーーーーーーーーーぷ
//タイマー系

time += 1;
if (time % 10 == 0){score += 1}

if (time > 100 && te < 0){
tey = -100
te = 0
}

if (time < 200 && tey <= 128){
tey += 3

aud.currentTime  = 0.0;
aud.muted = true
}



var habataka = window.innerHeight  / window.innerWidth

var ctly = 0//＋の場所
if (window.innerWidth * 1.2 > window.innerHeight ){ctly = window.innerHeight / 2} 
if (window.innerHeight >= window.innerWidth * 1.2){ctly = window.innerWidth + (window.innerHeight - window.innerWidth) / 2 - 50}


function mouse(x,y,a){//a は　down/start (0) かmove(1)かup(2)か。

var h = (widorhei / 256)
x /= h
y /= h
if (mv == 0){//初動か判定
var a = 70
if (x < 200){
if (x < 60){xx = -5}
if (x > 100){xx = 5}
if (y < 90){yy = -5}
if (y > 150){yy = 5}
}else if(x > right - 100){
chg = 1

}
}

}

function mouseup(x,y,a){//a は　down/start (0) かmove(1)かup(2)か。

var h = (widorhei / 256)
x /= h
y /= h
var a = 70
if (x < 200){
	mous = 1;mv = 0;xx = 0;yy = 0
}else if(x > right - 100 && chg >0){
chg =0;
shoot();
ch = 0;
}


}
if (ch > 100){
ch = 100;
}
if (chg ==1){
if (tp > 0){
ch += 2;
tp -= 2;
}else{tp += 2;}
}else{tp += 2;}
if (tp > 100){
tp = 100;
}
//コントロール系

if (playing == true){
window.addEventListener('touchstart' , () => {mous =  1;var touchObject = event.changedTouches[0] ;var touchX = touchObject.pageX ;var touchY = touchObject.pageY ;mouse(touchX,touchY);aud.muted = false})
window.addEventListener('touchmove' , () => {mous = 1; var touchObject = event.changedTouches[0] ;var touchX = touchObject.pageX ;var touchY = touchObject.pageY ;mouse(touchX,touchY);;aud.muted = false})
window.addEventListener('touchend', () => {mouseup();})


window.addEventListener('keydown', (event) => {
var h = (widorhei / 256)
if (event.code == 'ArrowUp'){yyy = -1}
if (event.code == 'ArrowDown'){yyy = 1}
if (event.code == 'ArrowLeft'){xxx = -1}
if (event.code == 'ArrowRight'){xxx = 1}

if (event.code == 'Space'){mouse(right * h,(105 + yyy * 80) * h)
}else{
mouse((80 + xxx * 60) * h,(105 + yyy * 80) * h)
}

});
window.addEventListener('keyup',  (event) => {
var h = (widorhei / 256)
if (event.code == 'ArrowUp'){yyy = 0}
if (event.code == 'ArrowDown'){yyy = 0}
if (event.code == 'ArrowLeft'){xxx = 0}
if (event.code == 'ArrowRight'){xxx = 0}
if (event.code == 'Space'){mouseup(right * h,(105 + yyy * 80) * h)
}else if (xxx == 0 && yyy == 0){mous = 1;mv = 0;xx = 0;yy = 0
}


});
//ctx.rect(50, 40,40, 160);
//ctx.rect(10, 100,120, 40);

}


for (i = 0;i < 5;i += 1){
ctx.drawImage(img1,i * 256 + -(time * 2) % 256,0,256,256)
}

var ss = score / 20
if (ss > 50){
ss = 55
}

if (te == 0){
if ((time / 7) % 7 == 0){
tt(4,right,Math.random() * 256,-10,0)
}
}


if (te >= 0){
ctx.drawImage(img3[te],right - 60 - img3[te].width,tey-img3[te].height/2,img3[te].width,img3[te].height)
aud.muted = false
if (px > right - img3[te].width - 70 && py > tey-30 && py < tey + 30){hp -= 10
}
}else{}


for (i = 0;i < t.length - 1;i += 1){
var im = imgs[t[i].s]
var w = im.width
var h = im.height
ctx.drawImage(imgs[t[i].s],t[i].x-w / 2,t[i].y-h / 2,w,h)

t[i].x += t[i].xx
t[i].y += t[i].yy

if (px > t[i].x-w/2 && px < t[i].x+w/2 && py>t[i].y-h/2 && py < t[i].y+h/2){
var d = 1
if (t[i].s == 0){d = 2}
if (t[i].s == 1){d = 5}
if (t[i].s == 2){d = 3}

hp -= d
}

}


for (i = 0;i < s.length;i += 1){
if (i < s.length){ 
ctx.beginPath();
ctx.fillStyle = 'rgba(' + [255 , 255 , 255 , 0.8] + ')';
ctx.arc(s[i].x,s[i].y,s[i].p,s[i].p,0,360,360);
ctx.fill();
ctx.font = (10 + Math.trunc(s[i].p)) + 'px Pixel';
ctx.fillStyle = '#88f';
ctx.fillText('#',s[i].x - (10 + Math.trunc(s[i].p)) /3,s[i].y +  (10 + Math.trunc(s[i].p)) / 3)
ctx.closePath();

s[i].x += s[i].xx;                     

for (j = 0;j < t.length;j += 1){
if (i < s.length){ 
if ((t[j].x - s[i].x)**2+(t[j].y-s[i].y)**2 < (s[i].p) ** 2 + ((imgs[t[j].s].width+imgs[t[j].s].height)/2)**1.5){
t[j].x += 50 + s[i].p
//t[j].xx /= 2
if (s[i].p > 50){
if (t[j].y > s[i].y){
t[j].yy = 5
}
if (t[j].y < s[i].y){
t[j].yy = -5
}
}
s.splice(i,1);
}
}
}
}
}


px += xx
py += yy

var left = 152

if (window.innerWidth < window.innerHeight * 1.9){left = 32}
if (px < left){px = left}
if (px > right - 52){px = right - 52}
if (py < 32 ){py = 32}
if (py > 256-32){py =256 - 32}

ctx.drawImage(img2,px -32,py-32,65,65)

if (window.innerWidth > window.innerHeight * 1.9){

ctx.beginPath();ctx.rect(50, 40,40, 160);ctx.strokeStyle = 'deepskyblue';ctx.lineWidth = 4;ctx.stroke();

ctx.rect(10, 100,120, 40);ctx.strokeStyle = 'deepskyblue';ctx.lineWidth = 4;ctx.stroke();ctx.closePath();

var ch1 = ch
if (ch <= 0){
ch1 = 1
}else if(ch > 100){ch1 = 100}
var chh = Math.trunc(ch1/100*15)
ctx.fillStyle = '#FF' + chh.toString(16)
ctx.beginPath();ctx.ellipse(right -44, 125,25,80,0,0,360);ctx.strokeStyle = '#FF' + chh.toString(16);ctx.lineWidth = 3 + (chh / 4);ctx.stroke();ctx.closePath();

ctx.font = '20px Pixel'
var tl = 50
ctx.fillText(`s`,right - tl,85)
ctx.fillText(`h`,right - tl,105)
ctx.fillText(`o`,right - tl,125)
ctx.fillText(`o`,right - tl,145)
ctx.fillText(`t`,right - tl,165)
}

ctx.beginPath();ctx.lineWidth = 13;ctx.moveTo(10,10);ctx.lineTo(110,10);ctx.strokeStyle = 'Red';ctx.stroke();ctx.closePath();
if (hp > 0){
ctx.beginPath();ctx.moveTo(10,10);ctx.lineTo(10 + hp,10);ctx.strokeStyle = 'lime';ctx.stroke();ctx.closePath();
}
//ctx.beginPath();ctx.lineWidth = 13;ctx.moveTo(10,30);ctx.lineTo(110,30);ctx.strokeStyle = 'Red';ctx.stroke();ctx.closePath();
if (tp > 0){
ctx.beginPath();ctx.moveTo(10,30);ctx.lineTo(10 + tp,30);ctx.strokeStyle = 'magenta';ctx.stroke();ctx.closePath();
}
if (playing == true){
requestAnimationFrame(main);
aud.play();
}
if (gameover == true){

var iimg = new Image()
iimg.src = 'title.png'
if (window.innerWidth > window.innerHeight){
ctx.drawImage(iimg,right / 2 - 128,0,256,256)
}else{
ctx.drawImage(iimg,0,0,256,256)}
ctx.fillText('Oh, Blue Bird!',2,170)
}
if (gameover == true){
px = 0
py = 0
ts =[]
tx = []
ty = []
txx = []
tyy = []

window.addEventListener('touchend', () => {document.location.reload()})
document.addEventListener('keyup' , () => {document.location.reload()})

}
}

//ページと依存（いぞん）している全てのデータが読み込まれたら、メインループ開
if (playing == false){
window.addEventListener('touchend', () => {if (playing == false && window.innerWidth > window.innerHeight){main();playing = true;requestAnimationFrame(main);aud.play();}})
document.addEventListener('keyup' , () => {if (playing == false && window.innerWidth > window.innerHeight){main();playing = true;requestAnimationFrame(main);}})
}
var iimg = new Image()
iimg.src = 'title.png'

addEventListener('load',() => {
if (window.innerWidth > window.innerHeight){
ctx.drawImage(iimg,right / 2 - 128,0,256,256)
}else{ctx.drawImage(iimg,0,0,256,256)}
ctx.font = '25px Pixel'
ctx.fillStyle = '#f0f';
ctx.fillText('横画面にしてちょーだい',2,bottom - 100)
ctx.fillText('Play with landscape screen.',2,bottom - 70)
ctx.fillText('Tap to start.(Or press key)',2,bottom - 40)
var scr = parseInt(localStorage.getItem('score'));
if (scr > 0){
ctx.fillText('High Score:' + scr,2,bottom - 10)
}
});
// スクロールを禁止にする関数
function disableScroll(event) {
  event.preventDefault();
}
window.addEventListener('visibilitychange', function() {
    if (document.visibilityState === 'hidden') {
	aud.muted = true;
    } else {
	aud.muted = false;
    }
});

// スクロール禁止
  document.addEventListener('touchmove', disableScroll, { passive: false });
  document.addEventListener('mousewheel', disableScroll, { passive: false });
	</script>
</body>
</html>
